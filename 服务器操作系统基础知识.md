# 服务器定义及发展

## 服务器类型

> 按外形

- 塔式服务器
- 机架服务器
- 刀片式服务器
- 高密度服务器

> 按CPU数量

- 单路服务器
- 双路
- 多路

> 按指令集（内核）

- 精简指令集RISC（非X86架构）
- 复杂指令集CISC（X86架构）

> 按应用

- 数据库服务器
- 文件服务器
- 应用服务器
- Web服务器
- 接入服务器

## 服务器硬件组成

### 核心组件

- CPU
- 内存
- 硬盘

### 基础硬件

- 主板
- 电源
- 风扇
- 机箱
- 网卡等可选组件

## 服务器技术和架构

### 技术架构的三大发展趋势

- Scale-up-纵向扩展架构
  ```
  适用于高性能业务场景
  ```

- Scale-out-横向扩展架构

  ```
  1. 高并发、低成本、高密度、节能低碳、统一管理等特点
  2. 适用于超大规模数据中心、大数据分析、公有云、Web应用集群等业务场景
  ```

- Hyper-converged-超融合架构
  ```
  1. 在同一套单元设备（x86服务器）中不仅仅具备计算、网络、存储和服务器虚拟化等资源和技术，而且还包括缓存加速、重复数据删除、在线数据压缩、备份软件、快照技术等元素，而多节点可以通过网络聚合起来，实现模块化的无缝横向扩展（scale-out），形成统一的资源池。
  2. 适用于数据库整合、云计算资源池平台、一体化数据中心、高性能数据分析等场景
  ```

### 服务器部署模式

- 单机系统——工作站
- C/S
- B/S

### 服务器上层软件架构

- 操作系统/虚拟化——IaaS
- 数据库、中间件等——PaaS
  - 中间件为上层应用软件提供运行和开发环境，提供预制可复用的业务功能模块、API接口等
- 业务应用软件——SaaS

## linux基础

### 概述


>Linux结构

- 硬件

- 内核kernel

- 外壳shell

  ```
  1. 用户和内核之间的命令解析器
  2. sh、csh、ksh
  ```

- 应用程序

> 特点

- 多任务

  ```
  CPU时间分片，分给不同的进程
  ```

- 多用户

  ```
  允许多个用户同时登陆使用
  ```

- 管道功能

  ```
  前一个程序的输出作为后一个程序的输入
  ```

- 强大的shell

  ```
  解释型高级语言
  ```

- 安全机制

- 稳定性

  ```
  unix  > linux > windows
  ```

- 强大的网络支持

  ```
  linux与TCP/IP 完美结合
  ```

- 用户界面

- 移植性好

  ```
  内核由C语言编写，易于移植
  ```

### 用户和用户组

- UID

  > 用户ID信息文件：/etc/passwd

  ```
  /etc/passwd文件结构:
  用户名 ：密码 ：UID ：GID ：用户描述 ：用户家目录 ：用户shell类型（每一行代表一个账号，包含若干系统账号）

  注意：/etc/passwd不安全，/etc/shadow支持SHA-256和SHA-512密码哈希
  ```

  > SuperUser：UID=0

  > SystemUser：UID=1-499（系统账号）

  ```
  1~99：由distributions自行创建的系统账号
  100~499：若用户有系统账号需求时，可以使用的账号UID
  ```

  > 一般用户：UID = 500-65535

  > 管理本地用户

  ```
  1、创建用户
    useradd [-u UID] [-g 初始用户组] [-G 次要用户组] [-m/M] [-c 用户描述] [-d 用户家目录] [-s shell] Uname
     默认情况下不设置密码用户无法登陆
     [-s shell]缺省表示/bin/bash
     m:强制创建用户主文件夹（一般账号默认值）
     M：强制不创建用户主文件夹（系统账号默认值）
  2、删除用户
     userdel Uname：默认主目录保持不变
     userdel -r Unam ：一起删除用户主目录
  3、修改用户信息
  	usermod [-参数] Uname
  ```

- GID

  > GID信息文件：/etc/group

  ```
  /etc/group文件结构：
  组名:组密码:GID:加入该组的用户
  ```

  > 没有SuperGroup

  > SystemGroup：GID = 0-499

  > 一般组：GID = 500-60000

### 文件和目录管理

- 目录结构

  ![](images/目录结构.png)

- 绝对路径 &  相对路径

- pwd [-P]

  ```
  显示当前路径
  -P:显示当前路径，而非连接（link）路径
  ```

- cd [ 目录 ]

  ```
  切换目录
  1、cd ~[用户名]：回到指定用户的主文件夹
  2、cd：回到主文件夹
  3、cd ..：返回上层目录
  4、cd -
  ```

- mkdir

  ```
  mikdir [-mp] 目录名
  -p：建立目录时建立其所有不存在的父目录
  -m：配置权限
  ```

- rmdir：删除“空”的目录

  ```
  rmdir [-p] 目录名
  -p：连同上层“空”的目录一起删除。
  ```

- cp：复制文件或者目录

  ```
  cp [-参数] source destination
  ```

  ![](images/cp.png)

- mv：移动文件或者目录，或者更名

  ```
  mv [-参数] source destination
  ```

  ![](images/mv.png)

- rm：移除文件或目录

  ```
  rm [-fir] 文件或目录
  ```

  ![](images/rm.png)

- find

- 文件内容查询

  - cat
  - tac
  - nl（添加行号打印）

- 可翻译查看

  - more

    ![](images/more.png)

  - less

    ```
    less [参数] 文件
    ```

    ![](images/less.png)

- touch

  ```
  修改文件时间
  创建新文件
  ```

### 文件系统管理

- 概念

  > 操作系统用于明确存储和组织计算机数据的方法

- 数据三要素

  - 文件名
  - 数据
  - 元数据meta-date：文件有关的信息

- 历史


  ```
  windows 98以前主要的文件系统是FAT/FAT16
  windows 2000之后主要是NTFS文件系统
  默认windows不会认识ext2文件系统
  ```

- 文件系统支持类型，可查看/etc/filesystems

- 文件系统分类

  > 是否日志文件

  - 传统型文件系统

    ```
    如：ext2文件系统，linux默认文件系统
    ```

  - 日志型文件系统

    ```
    如：ext3、ReiserFS
    ext3在ext2基础上加入日志功能
    ReiserFS基于平衡树，搜索快，节约空间
    ```

  > 是否有索引 
  -   索引式文件系统

      ```
      文件属性信息和实际内容存放在不同的区块
      inode + Block + super block
      【inode】：记录文件属性 + 数据所在block号
      【block】：实际文件内容
      【super block】：记录文件系统整体信息，inode/block总量、使用量、剩余量，文件系统的格式与相关信息
      ```

  - 非···

      ```
      只有Block，数据需要一个block一个block的读取
      如：windows下的FAT文件系统
      磁盘碎片整理:文件写入的block过于离散，读取性能低，此时需要磁盘碎片整理，将同一文件所属的block汇合在一起
      ```

- 配置文件系统分区

  ```
  【挂载】
  将文件系统与目录树结合的操作
  【挂载点】
  挂载点是目录，该目录是进入该文件系统的入口
  ```

  - 创建分区

    ```
    语法：fdisk [参数] 设备名
    -l：输出后面所接设备所有的分区内容
    步骤：1 选择分区类型
    	 2 选择分区开始的磁柱
    	 3 决定分区大小
    	 4 保存新建的分区
    	 5 重启服务器或partprobe命令通知内核
    ```

  - 磁盘格式化

    ```
    语法：mkfs [参数] 设备名
    参数说明：-t：指定文件系统格式
    		 -b：指定block大小
    分区完成后进行文件系统的格式化，mkfs是个综合的命令，会去调用正确的文件系统格式化工具软件
    ```

  - 磁盘检验

    ```
    fsck [-t 文件系统类型] [-ACay] 设备名
    ```

  - 挂载文件系统

    ```
    语法：mount [参数] 设备名 挂载点
    参数说明：-t：指定文件系统类型
    		 -b：指定block大小
    ```

- 管理Linux文件系统

  - 磁盘与目录的容量

    > df：列出文件系统的整体磁盘使用量

    ```
    df [参数] 目录或文件
    缺省参数：以1kb的容量显示出来
    -h：以容易阅读的GB等格式显示
    -m：以MB的容量显示各文件系统大小
    -i：不用硬盘容量，而用inode的数量来显示
    ```

    > du：评估文件系统的磁盘使用量

    ```
    du [参数] 目录或文件
    ```

  - 查看系统打开的文件

    ```
    lsof
    ```

  - 修复文件系统

    ```
    1、fsck
    检查并尝试修复文件系统错误
    执行fsck时，必须将要修复的设备尽心umount后，再执行命令
    2、e2fsck
    检查和修复ext2和ext3文件系统
    ```



### LVM管理

- 什么是LVM？

  ```
  逻辑卷管理，LVM将一个或多个硬盘的分区在逻辑上集合，相当于一个大硬盘来使用，当硬盘的空间不够使用的时候，可以继续将其它的硬盘的分区加入其中，这样可以实现磁盘空间的动态管理，相对于普通的磁盘分区有很大的灵活性。
  ```

- LVM架构

  ![](images/LVM架构.png)

  > 基本术语

  - LV
  - VG
  - PV：物理卷，标记为LVM可用的空间，通常是分区类型0x8e标记。

  > 分区类型

  - 82：swap
  - 83：ext3/ext4
  - 8e：LVM分区
  - fd：RAID分区

- LVM优点

  ```
  1、文件系统可以跨越多个磁盘
  2、动态扩展文件系统大小
  3、便于增加新磁盘到LVM的存储池中
  ```

- 创建及管理逻辑卷

  > https://linux.cn/article-3218-1.html

  - 准备磁盘分区（LVM分区）

    ![](images/创建分区.png)

  - 创建PV

    ```
    pvcreate /dev/sdb1
    pvscan/pvdisplay：查看物理卷
    pvremove /dev/sdb1：删除物理卷
    ```

  - 创建卷组VG

    ```
    vgcreate VGname PV1 PV2···
    vgscan/vgdisplay：查看卷组
    vgremove VGname：删除卷组
    ```

  - 创建逻辑卷LV

    ![](images/创建LV.png)

> **创建好逻辑卷之后就可以进行格式化并挂载了**

- 管理文件系统空间

  > 增加文件系统空间——扩展逻辑卷的大小

  ```
  1、如果没有可用的卷组空间，则需要先扩展卷组
  ```

  ![](images/扩展VG.png)

  ```
  2、扩展逻辑卷和文件系统,在扩展逻辑卷之前首先必须卸载该逻辑卷（umount）
  ```

  ![](images/扩展逻辑卷和文件系统.png)

  >缩小文件系统空间——缩小逻辑卷的大小

  ```
  在缩小逻辑卷之前首先必须卸载该逻辑卷（umount）
  ```
  ![](images/缩小逻辑卷.png)

### 网络管理

- 查看网口配置

  ```
  语法：ifconfig
  ```

- 修改网口的配置

  ```
  语法：ifconfig
  保存配置信息，避免重启网络服务或操作系统后失效
  	1、编辑配置文件配置网口：vi /etc/sysconfig/network/ifcfg-[网口]
  	2、启动网口,使配置生效：ifup /etc/sysconfig/network/ifcfg-[网口]
  ```

- 查询路由表

  ```
  语法：route
  在root下执行
  ```

- 新增路由

  ```
  语法：route add
  重启系统失效——修改配置文件/etc/sysconfig/network/routes
  	1、该文件用来保存静态路由数据
  	2、需重启生效
  ```

- 侦测网络

  >ping

  > traceroute

- 配置常用网络服务

  > 配置FTP服务

  ![](images/配置FTP服务.png)

  > 配置Telnet服务

  ![](images/配置Telnet服务.png)

### 进程和任务管理

- 进程管理

  > 相关概念

  ![](images/进程管理.png)

  > 查看进程

  ```
  ps
  top
  pstree
  ```

  > 结束进程

  ```
  kill
  killall
  ```

- 任务管理

  > 相关概念

  ![](images/任务管理.png)

  > 相关命令

  ```
  &
  jobs
  ctrl + Z: 将正在运行的任务放入后台暂停
  fg
  bg
  ```

  > 管理周期计划任务

  ```
  语法：crontab [-u user] [-e|-l|-r]
  ```

  > 管理定时任务

  ```
  语法：at
  ```

### 系统监控

